#!/usr/bin/env ruby

require "serialport"
 
#params for serial port
port_str = ARGV[0] # serial device
#baud_rate = ARGV[1].to_i || 115200
baud_rate = 9600
data_bits = 8
stop_bits = 1
parity = SerialPort::NONE

unless port_str 
  puts "usage: $0 {serial-device}"
  exit
end
  
sp = SerialPort.new(port_str, baud_rate, data_bits, stop_bits, parity)

#just read forever
while true do
  pattern = 60.times.map { Random.rand(255) }
  ack = sp.readline()
  puts ack
  if ( ack =~ /READY/ )
    puts "writing..."
    #pattern.each do |colour|
      #puts colour
      sp.write('Yaabbcc000000aabbcc000000aabbcc000000Z')
    #end
  end
end                       
sp.close  

